

xss 防范：
（前端开发与服务端开发，HTTP，Cookie， Ajax）

- 了解Xss定义
- 理解Xss原理
- 了解常见的Xss攻击方式
- 掌握Xss的防御措施

xss的攻击方式（Dos攻击）

- 反射型

url输入，服务端返回，并解析（一般是js代码）

 实例讲解：
 express -e ./
 npm install
 code ./
 npm start
 localhost:3000
在 index.js中

在router/index.js中获得请求url内容
res.render('index', { title: 'Express', xss:req.query.xss });

<%- xss %> -表示解析html
在url中输入参数 ?xss=12
?xss=<img src="null" onerror="alert(1)" />  img标签自动触发
?xss=<p onclick="alert('点我')">点我!</p>   这种是引诱触发
?xss=<iframe src="//baidu.com/t.html"></iframe> 这种是广告拦截（色情广告，计费广告）
- 存储型

怎么存在服务端呢？是怎样到达服务端呢？sql语句

xss攻击防御

编码
- 不要对用户的数据原样存储

- 对用户输入的数据进行HTML Entity编码

过滤
对用户输入的数据进行移除。

移除用户上传的Dom属性，如onerror事件

移除用户上传的style节点，script节点，iframe节点  body:display：none !important

js都是通过 src引入， 攻击者通过js非同源策略，可以完全操作我们的页面

校正
避免直接对HTML Entity 解码，
使用DOM Parse转换，校正不匹配的的Dom标签， 输入到文本 --> DOM parse

实战：
通过构建Node服务和建立一个评论功能，实时演示Xss的攻击和防范（用户的输入，服务端存储，客户端的展现），看看哪些是套路

xss防御：

1. 接口构造

// 假设用户的评论数据就在缓存中喽
var comments = {};

// 采用html编码
function html_encode(str){
  var s = '';
  if(str.lenth == 0) return '';
  s = str.replace(/&/g,"&gt;");
  s = s.replace(/</g, '&lt;');
  s = s.replace(/>/,'&gt;');
  s = s.replace(/\s/,'&nbsp;');
  s = s.replace(/\'/,'&#39;');
  s = s.replace(/\"/,'&quot;');
  s = s.replace(/\n/,'<br>;');
  return s;
}

//设置评论
router.get('/comment', function(req, res, next) {
  comments.v = html_encode(req.query.comment);
});

//获取评论
router.get('/getComment', function(req,res,next){
  res.json({
      comment:comments.v
  })
})


2. 反转义解码

见代码

textarea中输入
<img src="null" onerror="alert(1)" />  img标签自动触发
<p onclick="alert('点我')">点我!</p>   这种是引诱触发



要怎么过滤呢？

在HTMLParse中增加过滤语句